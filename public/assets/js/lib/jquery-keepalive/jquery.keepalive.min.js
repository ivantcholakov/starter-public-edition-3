/**
 *  jQuery.keepalive plugin -- keep a PHP session alive
 *  Copyright (c) 2010 Wayne Walls - wfwalls(at)gmail(dot)com
 *  License: MIT License or GNU General Public License (GPL) Version 2
 *  Date: 26 August 2010
 *  @author Wayne Walls
 *  @version 1.0
 *
 */
;(function(i,k,e){var f,m=false,g=false,d=0,j=0,l=0,c=0,b=0,a=function(){var n=e.keepalive.options;return("Keep-alive: status: "+((m)?"running":"stopped")+", sent: "+d+", rcvd: "+j+", average round-trip: "+b+"ms<br>interval: "+n.interval+"ms, timeout: "+n.timeout+"ms, id: "+n.dataObject.id+", URL: "+n.url)},h=function(){var n=e.keepalive.options;d+=1;l=new Date().getTime();e.ajax({url:n.url,type:"POST",data:n.dataObject,datatype:"text",timeout:n.timeout,error:function(){if(g){jQuery("#ww-keepalive-status").html(a())}if(e.keepalive.options.errorCallback){if(e.isFunction(e.keepalive.options.errorCallback)){e.keepalive.options.errorCallback.call(null)}}},success:function(){j+=1;c+=(new Date().getTime()-l);b=(c/j);b=Math.round(b);if(g){jQuery("#ww-keepalive-status").html(a())}if(e.keepalive.options.successCallback){if(e.isFunction(e.keepalive.options.successCallback)){e.keepalive.options.successCallback.call(null)}}}})};e.keepalive={options:{url:"php/keepalive.php",dataObject:{id:"keepalive"},interval:300000,timeout:20000,errorCallback:null,successCallback:null},configure:function(n){n=n||{};this.options=e.extend(this.options,n);if(m){this.stop();this.start()}if(g){jQuery("#ww-keepalive-status").html(a())}},start:function(n){n=n||{};this.options=e.extend(this.options,n);f=setInterval(h,this.options.interval);m=true;if(g){jQuery("#ww-keepalive-status").html(a())}},stop:function(){clearInterval(f);m=false;if(g){jQuery("#ww-keepalive-status").html(a())}},toggleDisplay:function(){if(g){e("#ww-keepalive-status").remove();g=false}else{e("<div />",{id:"ww-keepalive-status",html:a()}).appendTo(k.body);g=true}}};e.keepalive.start()}(window,document,jQuery));